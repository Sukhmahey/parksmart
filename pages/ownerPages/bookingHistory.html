<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="../userPages/Assets/fevicon.svg"
      type="image/svg+xml"
    />
    <title>Booking History</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="logo">ParkSmart</div>
      <div class="user-actions">
        <button class="switch-user">Switch to User</button>
        <div class="profile-icon">ðŸ‘¤</div>
      </div>
    </header>
    <main>
      <div class="booking-container">
        <div class="tab-header">
          <button id="current-bookings" class="active">Current Booking</button>
          <button id="booking-history">Booking History</button>
        </div>
        <div class="tab-content"></div>
      </div>
    </main>
    <script type="module">
      import { getOwnerBookingHistory } from "../../js/crud.js";

      document.addEventListener("DOMContentLoaded", async () => {
        const bookingsContainer = document.querySelector(".tab-content");
        const currentBtn = document.getElementById("current-bookings");
        const historyBtn = document.getElementById("booking-history");

        async function fetchBookings(filter) {
          const snapshot = await getDocs(collection(db, "bookings"));
          let bookingsHTML = "";
          const now = new Date();
          snapshot.forEach((doc) => {
            const data = doc.data();
            const startTime = data.start_time.toDate();
            if (
              (filter === "current" && startTime > now) ||
              (filter === "history" && startTime <= now)
            ) {
              bookingsHTML += `
                            <div class="booking-card">
                                <img src="${
                                  data.image || "default.jpg"
                                }" alt="Parking Image">
                                <div class="details">
                                    <h4>${data.title}</h4>
                                    <p>${data.address}</p>
                                    <p>${new Date(
                                      data.start_time.toDate()
                                    ).toLocaleString()} - ${new Date(
                data.end_time.toDate()
              ).toLocaleString()}</p>
                                </div>
                                <div class="arrow">&rarr;</div>
                            </div>
                        `;
            }
          });
          bookingsContainer.innerHTML =
            bookingsHTML || "<p>No bookings found.</p>";
        }

        currentBtn.addEventListener("click", () => {
          currentBtn.classList.add("active");
          historyBtn.classList.remove("active");
          fetchBookings("current");
        });

        historyBtn.addEventListener("click", () => {
          historyBtn.classList.add("active");
          currentBtn.classList.remove("active");
          fetchBookings("history");
        });

        await fetchBookings("current"); // Load current bookings by default
      });
    </script>
  </body>
</html>
